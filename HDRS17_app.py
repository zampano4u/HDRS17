import streamlit as st
import pyperclip

st.set_page_config(page_title="HDRS-17", layout="centered")

st.title("Hamilton Depression Rating Scale, HDRS-17")
st.write("다음은 17개 항목으로 구성된 해밀턴 우울 평가 척도입니다. 각 항목에 가장 해당하는 반응을 선택하세요.")

questions = {
    1: "1. 우울한 기분",
    2: "2. 죄책감",
    3: "3. 자살",
    4: "4. 초기불면증",
    5: "5. 중기불면증",
    6: "6. 말기불면증",
    7: "7. 일과 활동",
    8: "8. 지체",
    9: "9. 초조",
    10: "10. 정신적 불안",
    11: "11. 신체적 불안의 생리적 현상",
    12: "12. 위장관계 신체증상",
    13: "13. 전반적인 신체증상",
    14: "14. 성적인 증상",
    15: "15. 건강염려증",
    16: "16. 체중감소 (A 또는 B 중 하나만 선택)",
    17: "17. 병식",
}

options = {
    1: ["없다 (0)", "물어보았을 때만 우울하다고 말한다 (1)", "자발적으로 우울하다고 말한다 (2)", "비언어적 표현으로 우울함을 나타낸다 (3)", "언어/비언어적으로 우울함만 표현한다 (4)"],
    2: ["없다 (0)", "자책, 실망감 표현 (1)", "죄의식, 과거의 실수 반복적 생각 (2)", "현재 병을 벌로 여김, 죄책망상 (3)", "비난 환청, 위협 환시 (4)"],
    3: ["없다 (0)", "삶의 가치 없음 느낌 (1)", "죽음을 상상함 (2)", "자살사고 또는 행동 (3)", "심각한 자살 시도 (4)"],
    4: ["없다 (0)", "간헐적 수면 어려움 (1)", "매일 밤 수면 어려움 (2)"],
    5: ["없다 (0)", "깊게 자지 못함 (1)", "자주 깨거나 뒤척임 (2)"],
    6: ["없다 (0)", "새벽에 깨지만 다시 잠듦 (1)", "깨고 나서 다시 잠들지 못함 (2)"],
    7: ["없다 (0)", "피로감, 기력 저하 느낌 (1)", "활동 흥미 저하, 무관심 (2)", "활동 시간 감소, 생산성 저하 (3)", "활동 중단, 도움 없이는 일상 어려움 (4)"],
    8: ["정상 (0)", "면담 시 약간 지체 (1)", "면담 시 뚜렷한 지체 (2)", "면담 어려움 수준 (3)", "혼미 상태 (4)"],
    9: ["없다 (0)", "조금 초조함 (1)", "만지작거림 등 (2)", "몸 계속 움직임 (3)", "손 비비기, 머리카락 뽑기 등 (4)"],
    10: ["없다 (0)", "긴장감, 과민함 (1)", "사소한 걱정 있음 (2)", "염려하는 태도 뚜렷 (3)", "묻지 않아도 공포 표현 (4)"],
    11: ["없다 (0)", "입마름, 방귀, 소화불량 등 (1)", "심계항진, 두통 (2)", "과호흡, 한숨 (3)", "기능 저해될 정도 (4)"],
    12: ["없다 (0)", "입맛 감소, 격려 없이 식사 가능 (1)", "격려 없이는 식사 어려움, 약 요구 (2)"],
    13: ["없다 (0)", "통증, 피곤함, 근육통 등 경도 (1)", "뚜렷한 신체 증상 (2)"],
    14: ["없다 (0)", "경도 성욕감퇴 (1)", "고도 성욕감퇴 (2)"],
    15: ["없다 (0)", "몸에 대한 과도한 관심 (1)", "건강 집착 (2)", "건강 반복 호소 (3)", "건강염려 망상 (4)"],
    16: ["체중감소 없음 (0)", "체중감소 의심 (1)", "확실한 체중감소 (2)", "주당 0.5kg 미만 (0)", "주당 0.5~1kg 미만 (1)", "주당 1kg 이상 (2)"],
    17: ["우울 및 병 인식 있음 (0)", "병 인정하나 외부 요인 탓 (1)", "병 부정 (2)"],
}

scores = []
with st.form("HDRS_form"):
    for i in range(1, 18):
        st.markdown(f"**{questions[i]}**")
        selected = st.selectbox("선택:", options[i], key=f"q{i}")
        score = int(selected.split("(")[-1].replace(")", ""))
        scores.append(score)
    submitted = st.form_submit_button("점수 계산하기")

if submitted:
    weight_score = max(scores[15], scores[16])  # 항목 16 A/B
    total_score = sum(scores[:15]) + weight_score

    if total_score <= 7:
        interpretation = "정상"
    elif total_score <= 13:
        interpretation = "경도 우울"
    elif total_score <= 18:
        interpretation = "중등도 우울"
    elif total_score <= 22:
        interpretation = "고도 우울"
    else:
        interpretation = "최고도 우울"

    report = "**Hamilton Depression Rating Scale, HDRS**\n\n"
    for i in range(1, 18):
        report += f"{questions[i]}: {options[i][scores[i-1]]}\n"
    report += f"\n총점: {total_score}\n임상적 해석: {interpretation}"

    st.code(report)
    if st.button("결과 복사하기"):
        pyperclip.copy(report)
        st.success("결과가 클립보드에 복사되었습니다.")

